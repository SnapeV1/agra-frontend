<app-navigation></app-navigation>

<div class="profile-container">
  <!-- Header Section with Green Palette -->
  <div class="profile-header">
    <div class="profile-hero">
      <div class="profile-image-container">
        <img [src]="user.picture || 'assets/default-avatar.png'" 
             [alt]="user.name" 
             class="profile-image">
        <div class="image-overlay">
          <i class="edit-icon">📸</i>
        </div>
      </div>
      
      <div class="profile-info">
        <h1 class="profile-name">{{ user.name }}</h1>
        <div class="profile-meta">
          <span class="role-badge" [class.premium]="user.role === 'Premium User'">
            {{ user.role }}
          </span>
          <span class="registration-date">
            Member since {{ getRegistrationDate() }}
          </span>
        </div>
        <p class="profile-email">{{ user.email }}</p>
      </div>

      <div class="profile-actions">
        <button class="btn btn-primary" 
                [class.btn-secondary]="isEditing"
                (click)="toggleEdit()">
          {{ isEditing ? 'Annuler' : 'Modifier le Profil' }}
        </button>
        <button *ngIf="isEditing" 
                class="btn btn-success" 
                (click)="saveProfile()">
          Enregistrer
        </button>
      </div>
    </div>
  </div>

  <!-- Enhanced Stats Section -->
  <div class="stats-section">
    <h2 class="stats-title">
      <span class="title-icon">📈</span>
      Aperçu de vos Performances
    </h2>
    
    <div class="stats-grid">
      <div class="stat-card total">
        <div class="stat-icon">🌱</div>
        <div class="stat-content">
          <h3>{{ user.progress?.length || 0 }}</h3>
          <p>Cours Total</p>
          <span class="stat-subtitle">Formations inscrites</span>
        </div>
        <div class="stat-decoration"></div>
      </div>
      
      <div class="stat-card completed">
        <div class="stat-icon">🏆</div>
        <div class="stat-content">
          <h3>{{ getCompletedCourses() }}</h3>
          <p>Terminés</p>
          <span class="stat-subtitle">Certificats obtenus</span>
        </div>
        <div class="stat-decoration"></div>
      </div>
      
      <div class="stat-card progress">
        <div class="stat-icon">⚡</div>
        <div class="stat-content">
          <h3>{{ getInProgressCourses() }}</h3>
          <p>En Cours</p>
          <span class="stat-subtitle">Formations actives</span>
        </div>
        <div class="stat-decoration"></div>
      </div>
      
      <div class="stat-card average">
        <div class="stat-icon">🎯</div>
        <div class="stat-content">
          <h3>{{ getAverageProgress() }}%</h3>
          <p>Progression</p>
          <span class="stat-subtitle">Moyenne générale</span>
        </div>
        <div class="stat-decoration"></div>
      </div>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="profile-content">
    
    <!-- Personal Information Card -->
    <div class="info-section">
      <h2 class="section-title">
        <span class="section-icon">👤</span>
        Informations Personnelles
      </h2>
      
      <div class="info-grid" *ngIf="!isEditing">
        <div class="info-item">
          <label>Nom Complet</label>
          <span>{{ user.name }}</span>
        </div>
        
        <div class="info-item">
          <label>Email</label>
          <span>{{ user.email }}</span>
        </div>
        
        <div class="info-item" *ngIf="user.phone">
          <label>Téléphone</label>
          <span>{{ user.phone }}</span>
        </div>
        
        <div class="info-item" *ngIf="user.country">
          <label>Pays</label>
          <span>{{ user.country }}</span>
        </div>
        
        <div class="info-item" *ngIf="user.language">
          <label>Langue</label>
          <span>{{ user.language }}</span>
        </div>
        
        <div class="info-item" *ngIf="user.domain">
          <label>Domaine</label>
          <span>{{ user.domain }}</span>
        </div>
      </div>

      <!-- Enhanced Edit Form -->
      <form class="edit-form" *ngIf="isEditing" (ngSubmit)="saveProfile()">
        <div class="form-group">
          <label for="name">
            <span class="label-icon">👤</span>
            Nom Complet
          </label>
          <input type="text" 
                 id="name" 
                 class="form-control" 
                 [(ngModel)]="editForm.name" 
                 name="name"
                 placeholder="Votre nom complet">
        </div>
        
        <div class="form-group">
          <label for="email">
            <span class="label-icon">📧</span>
            Email
          </label>
          <input type="email" 
                 id="email" 
                 class="form-control" 
                 [(ngModel)]="editForm.email" 
                 name="email"
                 placeholder="votre@email.com">
        </div>
        
        <div class="form-group">
          <label for="phone">
            <span class="label-icon">📱</span>
            Téléphone
          </label>
          <input type="tel" 
                 id="phone" 
                 class="form-control" 
                 [(ngModel)]="editForm.phone" 
                 name="phone"
                 placeholder="+33 6 12 34 56 78">
        </div>
        
        <div class="form-group">
          <label for="country">
            <span class="label-icon">🌍</span>
            Pays
          </label>
          <input type="text" 
                 id="country" 
                 class="form-control" 
                 [(ngModel)]="editForm.country" 
                 name="country"
                 placeholder="France">
        </div>
        
        <div class="form-group">
          <label for="language">
            <span class="label-icon">🗣️</span>
            Langue
          </label>
          <input type="text" 
                 id="language" 
                 class="form-control" 
                 [(ngModel)]="editForm.language" 
                 name="language"
                 placeholder="Français">
        </div>
        
        <div class="form-group">
          <label for="domain">
            <span class="label-icon">🎯</span>
            Domaine
          </label>
          <input type="text" 
                 id="domain" 
                 class="form-control" 
                 [(ngModel)]="editForm.domain" 
                 name="domain"
                 placeholder="Agriculture, Technologie...">
        </div>
      </form>
    </div>

    <!-- Enhanced Course Progress -->
    <div class="progress-section" *ngIf="user.progress && user.progress.length > 0">
      <h2 class="section-title">
        <span class="section-icon">📊</span>
        Progression des Cours
      </h2>
      
      <div class="progress-list">
        <div class="progress-item" *ngFor="let course of user.progress; let i = index">
          <div class="progress-header">
            <div class="course-info">
              <h3 class="course-name">{{ course.courseName }}</h3>
              <span class="course-id">Module #{{ i + 1 }}</span>
            </div>
            <div class="progress-stats">
              <span class="progress-percentage">{{ course.progress }}%</span>
              <div class="circular-progress" [attr.data-progress]="course.progress">
                <svg width="40" height="40">
                  <circle cx="20" cy="20" r="15" 
                          fill="none" 
                          stroke="#e6f3e6" 
                          stroke-width="3"/>
                  <circle cx="20" cy="20" r="15" 
                          fill="none" 
                          [attr.stroke]="getProgressColor(course.progress)"
                          stroke-width="3"
                          stroke-linecap="round"
                          [attr.stroke-dasharray]="94.2" 
                          [attr.stroke-dashoffset]="94.2 - (course.progress * 0.942)"
                          transform="rotate(-90 20 20)"/>
                </svg>
              </div>
            </div>
          </div>
          
          <div class="progress-bar-container">
            <div class="progress-bar">
              <div class="progress-fill" 
                   [style.width.%]="course.progress"
                   [style.background]="getProgressGradient(course.progress)">
              </div>
            </div>
            <div class="progress-markers">
              <span class="marker" [class.active]="course.progress >= 25">25%</span>
              <span class="marker" [class.active]="course.progress >= 50">50%</span>
              <span class="marker" [class.active]="course.progress >= 75">75%</span>
              <span class="marker" [class.active]="course.progress >= 100">100%</span>
            </div>
          </div>
          
          <div class="progress-meta">
            <div class="status-container">
              <span class="status-badge" [class]="course.status">
                <span class="status-dot"></span>
              </span>
              <span *ngIf="course.completedAt" class="completion-date">
                🎉 Terminé le {{ course.completedAt | date:'dd/MM/yyyy' }}
              </span>
            </div>
            <div class="course-actions">
              <button class="action-btn continue" *ngIf="course.status === 'in-progress'">
                Continuer
              </button>
              <button class="action-btn certificate" *ngIf="course.status === 'completed'">
                Certificat
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<app-footer></app-footer>